<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Filling Line Selection</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        select {
            width: 200px;
            padding: 8px;
        }
        button {
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <select id="productionLine">
            <option value="">请选择生产线</option>
            <!-- 动态加载L1-L15 -->
        </select>
        <select id="productName">
            <option value="">请选择产品</option>
            <!-- 动态加载产品名称 -->
        </select>
        <button onclick="submitSelection()">确认</button>
    </div>

    <script>
        // 加载生产线数据
        async function loadProductionLines() {
            const response = await fetch('/api/getProductionLines');
            const lines = await response.json();
            const select = document.getElementById('productionLine');
            lines.forEach(line => {
                const option = document.createElement('option');
                option.value = line.name;
                option.text = `${line.name} - ${line.note1}`;
                select.appendChild(option);
            });
        }

        // 加载产品数据
        async function loadProducts() {
            const response = await fetch('/api/getProducts');
            const products = await response.json();
            const select = document.getElementById('productName');
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product['pallet label'];
                option.text = product['Product Name'];
                select.appendChild(option);
            });
        }

        // 提交选择
        async function submitSelection() {
            const line = document.getElementById('productionLine').value;
            const productSelect = document.getElementById('productName');
            const productId = productSelect.value;
            const productName = productSelect.options[productSelect.selectedIndex].text;

            if (!line || !productId) {
                alert('请选择生产线和产品');
                return;
            }

            const data = {
                timestamp: new Date().toISOString().replace('T', ' ').slice(0, 19),
                'production line': line,
                'production ID': productId,
                'production Name': productName
            };

            const response = await fetch('/api/saveSelection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('保存成功');
            }
        }

        // 页面加载时初始化数据
        window.onload = () => {
            loadProductionLines();
            loadProducts();
        };
    </script>
</body>
</html>